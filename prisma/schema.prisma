// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// Transaction records for on-ramp and off-ramp
model Transaction {
  id              String   @id @default(cuid())
  type            String   // "onramp" | "offramp"
  status          String   // "pending" | "processing" | "completed" | "failed"
  userAddress     String   // User's Tempo wallet address
  amountUsd       Float    // Amount in USD (human readable)
  amountToken     String   // Amount in token units (with decimals as string for precision)

  // Stripe payment fields (for on-ramp)
  stripePaymentIntentId String? @unique
  stripePaymentStatus   String?

  // Blockchain transaction fields
  mintTxHash      String?  // Transaction hash for minting (on-ramp)
  transferTxHash  String?  // Transaction hash for user transfer to treasury (off-ramp)
  burnTxHash      String?  // Transaction hash for burning (off-ramp)

  // Off-ramp specific
  paymentMethodId String?  // Reference to payment method for payout
  payoutStatus    String?  // "queued" | "processing" | "paid" | "failed"
  payoutId        String?  // Stripe payout ID

  // Metadata
  memo            String?  // Optional memo/reference
  errorMessage    String?  // Error details if failed

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([userAddress])
  @@index([stripePaymentIntentId])
  @@index([status])
}

// Stripe Connected Accounts for off-ramp payouts
model ConnectedAccount {
  id                      String   @id @default(cuid())
  userAddress             String   @unique  // User's Tempo wallet address
  stripeAccountId         String   @unique  // Stripe connected account ID (acct_xxx)
  onboardingComplete      Boolean  @default(false)
  chargesEnabled          Boolean  @default(false)
  payoutsEnabled          Boolean  @default(false)

  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  @@index([userAddress])
}

// Token deployment info (for tracking deployed AcmeUSD)
model TokenDeployment {
  id              String   @id @default(cuid())
  name            String
  symbol          String
  tokenAddress    String   @unique
  deployerAddress String
  deployTxHash    String

  // Fee AMM liquidity info
  feeAmmPoolAddress   String?
  liquidityTxHash     String?
  liquidityAmount     String?

  createdAt       DateTime @default(now())
}
